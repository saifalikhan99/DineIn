{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Modern Place Order Page -->
<div class="place-order-container py-5" style="background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh;">
    <div class="container">
        <!-- Progress Indicator -->
        <div class="progress-indicator mb-5">
            <div class="progress-step completed">
                <div class="progress-circle"><i class="fa fa-check"></i></div>
                <div class="progress-label">Cart</div>
            </div>
            <div class="progress-step completed">
                <div class="progress-circle"><i class="fa fa-check"></i></div>
                <div class="progress-label">Checkout</div>
            </div>
            <div class="progress-step active">
                <div class="progress-circle"><i class="fa fa-credit-card"></i></div>
                <div class="progress-label">Payment</div>
            </div>
            <div class="progress-step">
                <div class="progress-circle"><i class="fa fa-flag-checkered"></i></div>
                <div class="progress-label">Complete</div>
            </div>
        </div>

        <div class="row">            <!-- Billing Address Card -->
            <div class="col-lg-7 col-md-12 mb-4">
                <div class="card checkout-card h-100">
                    <div class="card-header bg-primary text-white py-3">
                        <h4 class="mb-0 section-title"><i class="fa fa-user-circle mr-2"></i>Billing Information</h4>
                    </div>
                    <div class="card-body">
                        <div class="billing-address p-3">
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <h5 class="text-muted mb-3">Personal Details</h5>
                                    <p class="mb-1"><strong>{{ order.name }}</strong></p>
                                    <p class="mb-1"><i class="fa fa-phone-alt text-primary mr-2"></i>{{ order.phone }}</p>
                                    <p class="mb-1"><i class="fa fa-envelope text-primary mr-2"></i>{{ order.email }}</p>
                                </div>
                                <div class="col-md-6">
                                    <h5 class="text-muted mb-3">Delivery Address</h5>
                                    <p class="mb-1">{{ order.address }}</p>
                                    <p class="mb-1">{{ order.city }} - {{ order.pin_code }}</p>
                                    <p class="mb-1">{{ order.state }}, {{ order.country }}</p>
                                </div>
                            </div>                            <div class="row">
                                <div class="col-12">
                                    <h5 class="text-muted mb-3">Payment Method</h5>
                                    <p><span class="badge badge-primary"><i class="fa fa-credit-card mr-1"></i>{{ order.payment_method }}</span></p>
                                </div>
                            </div>
                            
                            <!-- Test Cards Information Section -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <h5 class="text-muted mb-3"><i class="fa fa-info-circle text-info mr-2"></i>Test Payment Information</h5>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="test-card success-card p-3 rounded mb-3">
                                                <h6 class="text-success mb-2"><i class="fa fa-check-circle mr-2"></i>Successful Payment</h6>
                                                <div class="card-numbers">
                                                    <p class="mb-1"><strong>Card:</strong> <span class="test-card-number">4242 4242 4242 4242</span></p>
                                                    <p class="mb-1"><strong>Expiry:</strong> Any future date (e.g., 12/34)</p>
                                                    <p class="mb-0"><strong>CVC:</strong> Any 3 digits (e.g., 123)</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="test-card failed-card p-3 rounded">
                                                <h6 class="text-danger mb-2"><i class="fa fa-times-circle mr-2"></i>Declined Payment</h6>
                                                <div class="card-numbers">
                                                    <p class="mb-1"><strong>Card:</strong> <span class="test-card-number">4000 0000 0000 0002</span></p>
                                                    <p class="mb-1"><strong>Expiry:</strong> Any future date (e.g., 12/34)</p>
                                                    <p class="mb-0"><strong>CVC:</strong> Any 3 digits (e.g., 123)</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-2 text-center">
                                        <small class="text-muted">
                                            <i class="fa fa-info-circle mr-1"></i>These test cards only work in development mode. 
                                            <span class="copy-hint">Click a card number to copy it.</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-right mt-4">
                                <a href="{% url 'checkout' %}" class="btn btn-outline-primary">
                                    <i class="fa fa-edit mr-1"></i>Edit Details
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>            <!-- Order Summary and Payment Card -->
            <div class="col-lg-5 col-md-12">
                <div class="card checkout-card">
                    <div class="card-header bg-primary text-white py-3">
                        <h4 class="mb-0 section-title"><i class="fa fa-shopping-cart mr-2"></i>Your Order</h4>
                    </div>
                    <div class="card-body">
                        <!-- Order Items -->
                        <div class="order-items mb-4">
                            {% for item in cart_items %}
                            <div class="order-item d-flex align-items-center mb-3">
                                <div class="order-item-image mr-3">
                                    <img src="{{ item.fooditem.image.url }}" width="60" height="60" alt="Food Image" class="rounded" style="object-fit: cover;">
                                </div>
                                <div class="order-item-details flex-grow-1">
                                    <h6 class="mb-0">{{ item.fooditem }}</h6>
                                    <small class="text-muted">{{ item.fooditem.vendor }}</small>
                                </div>
                                <div class="order-item-quantity mx-3">
                                    <span class="badge badge-primary">{{ item.quantity }}x</span>
                                </div>
                                <div class="order-item-price text-right">
                                    <strong>₹{{ item.fooditem.price|floatformat:2 }}</strong>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Order Summary -->
                        <div class="order-summary p-3 rounded" style="background-color: #f8f9fa;">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal</span>
                                <span><strong>₹{{ subtotal|floatformat:2 }}</strong></span>
                            </div>

                            {% for key, value in tax_dict.items %}
                                {% for i, j in value.items %}
                                <div class="d-flex justify-content-between mb-2">
                                    <span>{{ key }} <small>({{ i }}%)</small></span>
                                    <span>₹{{ j }}</span>
                                </div>
                                {% endfor %}
                            {% endfor %}
                            
                            {% if discount_amount > 0 %}
                            <div class="d-flex justify-content-between mb-2 text-success">
                                <span>Discount {% if applied_coupon %}({{ applied_coupon }}){% endif %}</span>
                                <span>-₹{{ discount_amount|floatformat:2 }}</span>
                            </div>
                            {% endif %}

                            <div class="d-flex justify-content-between pt-2 mt-2 border-top">
                                <span><strong>TOTAL</strong></span>
                                <span><strong class="text-primary" style="font-size: 1.2rem;">₹{{ grand_total|floatformat:2 }}</strong></span>
                            </div>
                        </div>                        <!-- Stripe Payment Form -->
                        <div class="payment-form mt-4">
                            <h5 class="mb-3"><i class="fa fa-lock text-success mr-2"></i>Secure Payment</h5>
                            <div class="card-wrapper mb-3">
                                <div id="card-element" class="form-control card-element">
                                    <!-- Stripe Elements will create form elements here -->
                                </div>
                                <div id="card-errors" role="alert" class="mt-2 text-danger"></div>
                            </div>
                            
                            <button id="submit-payment" class="btn btn-primary btn-lg btn-block payment-button">
                                <span id="button-text">
                                    <i class="fa fa-lock mr-2"></i> Pay ₹{{ grand_total|floatformat:2 }}
                                </span>
                                <div id="spinner" class="spinner-border spinner-border-sm d-none ml-2" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </button>
                            
                            <div class="payment-security mt-3 text-center">
                                <small class="text-muted d-flex justify-content-center align-items-center">
                                    <span class="security-badge mr-2"><i class="fa fa-shield-alt"></i></span> Secured by Stripe
                                    <span class="mx-2">|</span>
                                    <span class="security-badge mr-2"><i class="fa fa-lock"></i></span> 256-bit SSL Encryption
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Modern Place Order Page End -->

<!-- Modern Place Order Page End -->

<script src="https://js.stripe.com/v3/"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Country name to ISO code mapping
    const countryCodeMap = {
        'India': 'IN',
        'United States': 'US',
        'United Kingdom': 'GB',
        'Canada': 'CA',
        'Australia': 'AU',
        'Germany': 'DE',
        'France': 'FR',
        'Japan': 'JP',
        'China': 'CN',
        'Brazil': 'BR',
        'Mexico': 'MX',
        'Italy': 'IT',
        'Spain': 'ES',
        'Netherlands': 'NL',
        'Sweden': 'SE',
        'Norway': 'NO',
        'Denmark': 'DK',
        'Finland': 'FI',
        'Poland': 'PL',
        'Russia': 'RU',
        'South Korea': 'KR',
        'Singapore': 'SG',
        'Malaysia': 'MY',
        'Thailand': 'TH',
        'Philippines': 'PH',
        'Indonesia': 'ID',
        'Vietnam': 'VN',
        'Pakistan': 'PK',
        'Bangladesh': 'BD',
        'Sri Lanka': 'LK',
        'Nepal': 'NP',
        'Afghanistan': 'AF',
        'Iran': 'IR',
        'Iraq': 'IQ',
        'Turkey': 'TR',
        'Saudi Arabia': 'SA',
        'United Arab Emirates': 'AE',
        'Qatar': 'QA',
        'Kuwait': 'KW',
        'Bahrain': 'BH',
        'Oman': 'OM',
        'Jordan': 'JO',
        'Lebanon': 'LB',
        'Israel': 'IL',
        'Egypt': 'EG',
        'South Africa': 'ZA',
        'Nigeria': 'NG',
        'Kenya': 'KE',
        'Ghana': 'GH',
        'Morocco': 'MA',
        'Algeria': 'DZ',
        'Tunisia': 'TN',
        'Ethiopia': 'ET',
        'Uganda': 'UG',
        'Tanzania': 'TZ',
        'Zimbabwe': 'ZW',
        'Zambia': 'ZM',
        'Botswana': 'BW',
        'Namibia': 'NA',
        'Argentina': 'AR',
        'Chile': 'CL',
        'Colombia': 'CO',
        'Peru': 'PE',
        'Ecuador': 'EC',
        'Bolivia': 'BO',
        'Paraguay': 'PY',
        'Uruguay': 'UY',
        'Venezuela': 'VE',
        'New Zealand': 'NZ'
    };

    // Function to get country code
    function getCountryCode(countryName) {
        return countryCodeMap[countryName] || countryName.substring(0, 2).toUpperCase();
    }

    // Set up test card number copying
    document.querySelectorAll('.test-card-number').forEach(function(element) {
        element.addEventListener('click', function() {
            const cardNumber = this.textContent.trim();
            
            // Create a temporary input element to copy the text
            const tempInput = document.createElement('input');
            tempInput.value = cardNumber;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            
            // Show feedback
            const originalText = this.textContent;
            this.textContent = 'Copied!';
            this.style.backgroundColor = '#d4edda';
            this.style.color = '#155724';
            
            // Reset after a short delay
            setTimeout(() => {
                this.textContent = originalText;
                this.style.backgroundColor = '';
                this.style.color = '';
            }, 1500);
        });
    });

    // Get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Check if Stripe key is available
    const stripeKey = '{{ STRIPE_PUBLISHABLE_KEY }}';
    console.log('Stripe key:', stripeKey ? 'Available' : 'Missing');
    
    if (!stripeKey) {
        showError('Payment system not configured. Please contact support.');
        return;
    }

    // Initialize Stripe
    const stripe = Stripe(stripeKey);
    const elements = stripe.elements();

    // Create card element with improved styling
    const cardElement = elements.create('card', {
        style: {
            base: {
                fontSize: '16px',
                color: '#32325d',
                fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
                fontSmoothing: 'antialiased',
                '::placeholder': {
                    color: '#aab7c4',
                },
                iconColor: '#6772e5',
            },
            invalid: {
                color: '#e74c3c',
                iconColor: '#e74c3c',
            },
        },
        hidePostalCode: true,
    });

    // Mount the card element
    cardElement.mount('#card-element');
    console.log('Card element mounted');

    // Handle real-time validation errors with nicer formatting
    cardElement.on('change', function(event) {
        const displayError = document.getElementById('card-errors');
        if (event.error) {
            displayError.innerHTML = '<div class="alert alert-danger py-2"><i class="fa fa-exclamation-triangle mr-2"></i>' + event.error.message + '</div>';
        } else {
            displayError.textContent = '';
        }
    });

    // Handle form submission with improved user feedback
    const submitButton = document.getElementById('submit-payment');
    
    submitButton.addEventListener('click', async function(event) {
        event.preventDefault();
        console.log('Payment button clicked');
        
        setLoading(true);
        clearErrors();

        try {
            // Get CSRF token
            const csrfToken = getCookie('csrftoken');
            console.log('CSRF token:', csrfToken ? 'Available' : 'Missing');
            
            if (!csrfToken) {
                throw new Error('CSRF token not found');
            }

            // Add pulse animation to card element
            document.querySelector('.card-wrapper').classList.add('pulsing');

            // Create payment intent
            console.log('Creating payment intent...');
            const response = await fetch('/orders/create-payment-intent/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                },
                body: JSON.stringify({
                    order_number: '{{ order.order_number }}'
                })
            });

            console.log('Payment intent response status:', response.status);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            const result = await response.json();
            console.log('Payment intent result:', result);

            if (result.error) {
                showError(result.error);
                setLoading(false);
                document.querySelector('.card-wrapper').classList.remove('pulsing');
                return;
            }

            // Show processing overlay with animation
            showProcessingOverlay('Verifying payment information...');

            // Get order details for billing
            const orderCountry = '{{ order.country }}';
            const countryCode = getCountryCode(orderCountry);
            console.log(`Converting country "${orderCountry}" to "${countryCode}"`);

            // Confirm payment with proper country code
            console.log('Confirming payment...');
            const {error: confirmError, paymentIntent} = await stripe.confirmCardPayment(result.client_secret, {
                payment_method: {
                    card: cardElement,
                    billing_details: {
                        name: '{{ order.first_name }} {{ order.last_name }}',
                        email: '{{ order.email }}',
                        address: {
                            line1: '{{ order.address }}',
                            city: '{{ order.city }}',
                            state: '{{ order.state }}',
                            country: countryCode,
                            postal_code: '{{ order.pin_code }}',
                        }
                    }
                }
            });

            // Remove pulsing animation
            document.querySelector('.card-wrapper').classList.remove('pulsing');

            if (confirmError) {
                console.error('Payment confirmation error:', confirmError);
                let errorMessage = confirmError.message;
                
                if (confirmError.type === 'card_error' || confirmError.type === 'validation_error') {
                    errorMessage = confirmError.message;
                } else if (confirmError.code === 'card_declined') {
                    errorMessage = 'Your card was declined. Please try the test card 4242 4242 4242 4242 for success.';
                } else {
                    errorMessage = 'An unexpected error occurred. Please try again.';
                }
                
                removeProcessingOverlay();
                showError(errorMessage);
                setLoading(false);
            } else {
                console.log('Payment confirmed successfully');
                updateProcessingOverlay('Payment successful! Processing your order...');
                
                // Update progress indicator
                updateProgressStep(4);
                
                // Process payment on server
                console.log('Processing payment on server...');
                const processResponse = await fetch('/orders/process-payment/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrfToken
                    },
                    body: JSON.stringify({
                        order_number: '{{ order.order_number }}',
                        payment_intent_id: paymentIntent.id
                    })
                });

                console.log('Process payment response status:', processResponse.status);
                
                if (!processResponse.ok) {
                    throw new Error(`HTTP ${processResponse.status}: ${processResponse.statusText}`);
                }
                
                const processResult = await processResponse.json();
                console.log('Process payment result:', processResult);

                if (processResult.success === true) {
                    updateProcessingOverlay('Order completed successfully! Redirecting...');
                    console.log('Redirecting to order complete page...');
                    setTimeout(function() {
                        window.location.href = processResult.redirect_url || '/orders/order_complete/?order_no=' + processResult.order_number + '&trans_id=' + processResult.transaction_id;
                    }, 2000);
                } else {
                    removeProcessingOverlay();
                    showError(processResult.error || 'Payment processing failed. Please try again.');
                    setLoading(false);
                }
            }
        } catch (error) {
            console.error('Payment error:', error);
            removeProcessingOverlay();
            showError('Network error: ' + error.message + '. Please check your connection and try again.');
            setLoading(false);
        }
    });    // Helper function to update progress step
    function updateProgressStep(step) {
        document.querySelectorAll('.progress-step').forEach(function(el, index) {
            el.classList.remove('active', 'completed');
            if (index < step - 1) {
                el.classList.add('completed');
                el.querySelector('.progress-circle').innerHTML = '<i class="fa fa-check"></i>';
            } else if (index === step - 1) {
                el.classList.add('active');
            }
        });
    }

    // Show processing overlay
    function showProcessingOverlay(message) {
        let overlay = document.getElementById('processing-overlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'processing-overlay';
            overlay.className = 'processing-overlay';
            overlay.innerHTML = `
                <div class="processing-content">
                    <div class="spinner-grow text-primary mb-4" role="status" style="width: 3rem; height: 3rem;">
                        <span class="sr-only">Processing...</span>
                    </div>
                    <h4 id="processing-message" class="mb-3">${message}</h4>
                    <div class="progress mt-2 mb-2" style="height: 10px; width: 80%; max-width: 300px;">
                        <div class="progress-bar progress-bar-striped progress-bar-animated bg-primary" role="progressbar" style="width: 0%"></div>
                    </div>
                    <small class="text-light-50">Please do not refresh or close this page</small>
                </div>
            `;
            document.body.appendChild(overlay);
            
            // Animate the progress bar
            setTimeout(() => {
                const progressBar = overlay.querySelector('.progress-bar');
                progressBar.style.width = '100%';
                progressBar.style.transition = 'width 10s linear';
            }, 100);
        } else {
            document.getElementById('processing-message').textContent = message;
        }
    }

    // Update processing overlay message
    function updateProcessingOverlay(message) {
        const messageEl = document.getElementById('processing-message');
        if (messageEl) {
            messageEl.textContent = message;
        }
    }

    // Remove processing overlay
    function removeProcessingOverlay() {
        const overlay = document.getElementById('processing-overlay');
        if (overlay) {
            overlay.classList.add('fade-out');
            setTimeout(() => {
                overlay.remove();
            }, 500);
        }
    }

    function showError(message) {
        console.error('Showing error:', message);
        const errorElement = document.getElementById('card-errors');
        errorElement.innerHTML = '<div class="alert alert-danger py-2"><i class="fa fa-exclamation-triangle mr-2"></i>' + message + '</div>';
    }
    
    function showSuccess(message) {
        console.log('Showing success:', message);
        const errorElement = document.getElementById('card-errors');
        errorElement.innerHTML = '<div class="alert alert-success py-2"><i class="fa fa-check-circle mr-2"></i>' + message + '</div>';
    }
    
    function clearErrors() {
        const errorElement = document.getElementById('card-errors');
        errorElement.textContent = '';
    }

    function setLoading(isLoading) {
        const button = document.getElementById('submit-payment');
        const buttonText = document.getElementById('button-text');
        
        if (isLoading) {
            button.disabled = true;
            button.classList.add('processing');
            buttonText.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> Processing...';
        } else {
            button.disabled = false;
            button.classList.remove('processing');
            buttonText.innerHTML = '<i class="fa fa-lock mr-2"></i> Pay ₹{{ grand_total|floatformat:2 }}';
        }
    }
});
</script>

<style>
/* Progress indicator */
.progress-indicator {
    display: flex;
    justify-content: space-between;
    position: relative;
    margin-bottom: 40px;
    padding: 0 20px;
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    position: relative;
    z-index: 1;
}

.progress-step::after {
    content: '';
    position: absolute;
    top: 20px;
    left: 50%;
    width: 100%;
    height: 3px;
    background: #e1e8ed;
    z-index: -1;
}

.progress-step:last-child::after {
    display: none;
}

.progress-step.active::after,
.progress-step.completed::after {
    background: #007bff;
}

.progress-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e1e8ed;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.progress-step.active .progress-circle {
    background: #007bff;
    box-shadow: 0 0 15px rgba(0, 123, 255, 0.5);
    transform: scale(1.1);
}

.progress-step.completed .progress-circle {
    background: #28a745;
}

.progress-label {
    font-size: 14px;
    color: #6c757d;
    transition: all 0.3s ease;
}

.progress-step.active .progress-label {
    color: #007bff;
    font-weight: 600;
}

.progress-step.completed .progress-label {
    color: #28a745;
    font-weight: 600;
}

/* Card styling */
.card {
    transition: all 0.3s ease;
}

.checkout-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    padding: 0;
    margin-bottom: 30px;
    border: none;
    transition: all 0.3s ease;
    overflow: hidden;
}

.checkout-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.15) !important;
}

.card-header {
    border-radius: 20px 20px 0 0 !important;
    border-bottom: none;
}

.section-title {
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 12px;
}

.section-title i {
    font-size: 1.1em;
}

/* Test cards */
.test-card {
    background-color: #f8f9fa;
    border-left: 4px solid;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}

.success-card {
    border-left-color: #28a745;
}

.failed-card {
    border-left-color: #dc3545;
}

.test-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.test-card-number {
    font-family: monospace;
    background-color: rgba(0,0,0,0.05);
    padding: 2px 5px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.test-card-number:hover {
    background-color: rgba(0,0,0,0.1);
}

.test-card-number:active {
    background-color: rgba(0,0,0,0.15);
}

.copy-hint {
    color: #007bff;
    font-style: italic;
}

.card-numbers {
    transition: all 0.3s ease;
}

/* Order items */
.order-item {
    transition: all 0.3s ease;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 15px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.05);
    border: 1px solid #f1f2f6;
}

.order-item:hover {
    background-color: #f8f9fa;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
}

.order-item-image {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
}

.order-item-image img {
    transition: all 0.3s ease;
}

.order-item:hover .order-item-image img {
    transform: scale(1.05);
}

.order-summary {
    background-color: #f8f9fa;
    border-radius: 12px;
    padding: 15px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
}

/* Card element styling */
.card-element {
    border: 1px solid #ced4da;
    border-radius: 12px;
    padding: 16px;
    transition: all 0.3s ease;
    background-color: #f8f9fa;
}

.card-element:focus {
    border-color: #80bdff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
    background-color: #fff;
}

.card-wrapper {
    transition: all 0.3s ease;
    border-radius: 12px;
    overflow: hidden;
}

.card-wrapper.pulsing {
    animation: pulse 1.5s infinite;
}

.security-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background-color: rgba(0,123,255,0.1);
    border-radius: 50%;
    color: #007bff;
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.4);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
    }
}

/* Payment button */
.payment-button {
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    padding: 12px;
    font-weight: 600;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 15px rgba(0,123,255,0.2);
}

.payment-button:before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.2) 50%,
        rgba(255, 255, 255, 0) 100%
    );
    transition: all 0.6s;
}

.payment-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,123,255,0.3);
}

.payment-button:hover:before {
    left: 100%;
}

.payment-button.processing {
    background: #007bff;
    box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
}

/* Processing overlay */
.processing-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.5s ease;
    animation: fadeIn 0.5s forwards;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.processing-overlay.fade-out {
    animation: fadeOut 0.5s forwards;
}

@keyframes fadeOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

.processing-content {
    text-align: center;
    color: white;
    padding: 40px;
    border-radius: 20px;
    max-width: 450px;
    width: 90%;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
    transform: translateY(30px);
    animation: slideUp 0.5s forwards;
}

@keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

/* Responsive design */
@media (max-width: 768px) {
    .progress-indicator {
        margin-bottom: 30px;
    }
    
    .progress-label {
        font-size: 12px;
    }
    
    .progress-circle {
        width: 35px;
        height: 35px;
        font-size: 14px;
    }
    
    .place-order-container {
        padding-top: 20px;
        padding-bottom: 20px;
    }
}
</style>

{% endblock %}